//@version=5
indicator("Free Trading Bot Signals", overlay=true)

// ============================================================================
// INPUT PARAMETERS
// ============================================================================

// RSI Settings
rsi_length = input.int(14, "RSI Length", minval=1)
rsi_oversold = input.float(30, "RSI Oversold Level", minval=0, maxval=100)
rsi_overbought = input.float(70, "RSI Overbought Level", minval=0, maxval=100)

// MFI Settings
mfi_length = input.int(14, "MFI Length", minval=1)
mfi_oversold = input.float(20, "MFI Oversold Level", minval=0, maxval=100)
mfi_overbought = input.float(80, "MFI Overbought Level", minval=0, maxval=100)

// Volume Settings
volume_multiplier = input.float(1.5, "Volume Multiplier", minval=1.0, step=0.1)

// Display Settings
show_signals = input.bool(true, "Show Signal Arrows")
show_labels = input.bool(true, "Show Signal Labels")
show_info_table = input.bool(true, "Show Info Table")

// ============================================================================
// INDICATORS CALCULATION
// ============================================================================

// Calculate RSI
rsi = ta.rsi(close, rsi_length)

// Calculate MFI
mfi = ta.mfi(close, mfi_length)

// Calculate volume conditions
volume_increasing = volume > volume[1] * volume_multiplier
volume_decreasing = volume < volume[1] / volume_multiplier

// Calculate price momentum
price_momentum = (close - close[1]) / close[1] * 100

// ============================================================================
// SIGNAL CONDITIONS
// ============================================================================

// Long (BUY) conditions
long_condition = rsi < rsi_oversold and 
                 mfi < mfi_oversold and 
                 volume_increasing and 
                 price_momentum > 0

// Short (SELL) conditions
short_condition = rsi > rsi_overbought and 
                  mfi > mfi_overbought and 
                  volume_increasing and 
                  price_momentum < 0

// Exit conditions
exit_long = rsi > rsi_overbought or mfi > mfi_overbought
exit_short = rsi < rsi_oversold or mfi < mfi_oversold

// ============================================================================
// PLOTTING
// ============================================================================

// Plot signal arrows
if show_signals
    plotshape(long_condition, title="BUY Signal", location=location.belowbar, color=color.green, style=shape.triangleup, size=size.small)
    plotshape(short_condition, title="SELL Signal", location=location.abovebar, color=color.red, style=shape.triangledown, size=size.small)
    plotshape(exit_long, title="Exit Long", location=location.abovebar, color=color.orange, style=shape.circle, size=size.tiny)
    plotshape(exit_short, title="Exit Short", location=location.belowbar, color=color.orange, style=shape.circle, size=size.tiny)

// Plot signal labels
if show_labels
    if long_condition
        label.new(bar_index, low, "BUY\nRSI: " + str.tostring(rsi, "#.##") + "\nMFI: " + str.tostring(mfi, "#.##") + "\nVol: " + str.tostring(volume / volume[1], "#.##") + "x", color=color.green, textcolor=color.white, style=label.style_label_up, size=size.small)
    
    if short_condition
        label.new(bar_index, high, "SELL\nRSI: " + str.tostring(rsi, "#.##") + "\nMFI: " + str.tostring(mfi, "#.##") + "\nVol: " + str.tostring(volume / volume[1], "#.##") + "x", color=color.red, textcolor=color.white, style=label.style_label_down, size=size.small)

// ============================================================================
// INFO TABLE
// ============================================================================

if show_info_table and barstate.islast
    var table info_table = table.new(position.top_right, 2, 8, bgcolor=color.white, border_width=1)
    
    table.cell(info_table, 0, 0, "Indicator", text_color=color.black, bgcolor=color.gray)
    table.cell(info_table, 1, 0, "Value", text_color=color.black, bgcolor=color.gray)
    
    table.cell(info_table, 0, 1, "RSI", text_color=color.black)
    table.cell(info_table, 1, 1, str.tostring(rsi, "#.##"), text_color=color.blue)
    
    table.cell(info_table, 0, 2, "MFI", text_color=color.black)
    table.cell(info_table, 1, 2, str.tostring(mfi, "#.##"), text_color=color.red)
    
    table.cell(info_table, 0, 3, "Volume Ratio", text_color=color.black)
    table.cell(info_table, 1, 3, str.tostring(volume / volume[1], "#.##"), text_color=color.purple)
    
    table.cell(info_table, 0, 4, "Momentum", text_color=color.black)
    table.cell(info_table, 1, 4, str.tostring(price_momentum, "#.##") + "%", text_color=color.orange)
    
    table.cell(info_table, 0, 5, "Signal", text_color=color.black)
    signal_text = long_condition ? "BUY" : short_condition ? "SELL" : "HOLD"
    signal_color = long_condition ? color.green : short_condition ? color.red : color.gray
    table.cell(info_table, 1, 5, signal_text, text_color=signal_color)
    
    table.cell(info_table, 0, 6, "Price", text_color=color.black)
    table.cell(info_table, 1, 6, str.tostring(close, "#.##"), text_color=color.black)
    
    table.cell(info_table, 0, 7, "Time", text_color=color.black)
    table.cell(info_table, 1, 7, str.tostring(time), text_color=color.black)

// ============================================================================
// ALERT CONDITIONS (for manual setup)
// ============================================================================

// Create alert conditions for manual setup
alertcondition(long_condition, title="BUY Signal", message="BUY {{ticker}} at {{close}} - RSI: {{plot('RSI')}} MFI: {{plot('MFI')}}")
alertcondition(short_condition, title="SELL Signal", message="SELL {{ticker}} at {{close}} - RSI: {{plot('RSI')}} MFI: {{plot('MFI')}}")
alertcondition(exit_long or exit_short, title="Exit Signal", message="CLOSE {{ticker}} at {{close}}")

// ============================================================================
// BACKGROUND COLOR (optional)
// ============================================================================

// Color the background based on signal strength
bgcolor(long_condition ? color.new(color.green, 90) : short_condition ? color.new(color.red, 90) : na)

// ============================================================================
// USAGE INSTRUCTIONS
// ============================================================================

// This indicator works with FREE TradingView accounts
// 
// To use with your trading bot:
// 1. Apply this indicator to your chart
// 2. Create manual alerts when you see BUY/SELL signals
// 3. Use the email-to-webhook bridge script
// 4. Or manually send signals to your bot
//
// Alert message format for manual alerts:
// "BUY BTCUSDT at 50000 - RSI: 25 MFI: 20"
// "SELL BTCUSDT at 52000 - RSI: 75 MFI: 80" 